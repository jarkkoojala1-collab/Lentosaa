<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LentoSÃ¤Ã¤ Pro - Expert</title>
    <style>
        :root {
            --bg: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --accent: #38bdf8;
            --success: #4ade80;
            --warning: #fbbf24;
            --danger: #f87171;
            --text: #f1f5f9;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: radial-gradient(circle at top right, #1e293b, #0f172a);
            color: var(--text);
            margin: 0; padding: 20px; min-height: 100vh;
        }

        .container { max-width: 500px; margin: auto; }
        h1 { font-weight: 800; text-align: center; margin-bottom: 5px; }
        .subtitle { opacity: 0.6; font-size: 0.8rem; text-align: center; margin-bottom: 20px; }

        /* Haku */
        .search-group {
            display: flex; background: var(--card-bg); padding: 5px; border-radius: 16px;
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px;
        }
        input { flex: 1; background: transparent; border: none; color: white; padding: 12px; outline: none; }
        button { background: var(--accent); border: none; padding: 10px 15px; border-radius: 12px; font-weight: 700; }

        /* Sektio */
        .section {
            background: var(--card-bg); border-radius: 20px; padding: 15px; margin-bottom: 15px;
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05);
        }

        /* Tuntikortit */
        .scroll-x { display: flex; overflow-x: auto; gap: 10px; padding: 10px 0; scrollbar-width: none; }
        .hour-card {
            background: rgba(255,255,255,0.05); padding: 12px; border-radius: 15px;
            min-width: 80px; text-align: center; border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer; transition: transform 0.2s;
        }
        .hour-card:active { transform: scale(0.95); }

        /* Yksityiskohtien sivu (Overlay) */
        #detailOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 100; display: none;
            padding: 30px 20px; box-sizing: border-box; overflow-y: auto;
        }
        .close-btn {
            position: absolute; top: 20px; right: 20px; font-size: 1.5rem;
            background: rgba(255,255,255,0.1); border-radius: 50%; width: 40px; height: 40px;
            display: flex; align-items: center; justify-content: center;
        }

        .model-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 20px;
        }
        .model-box {
            background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; text-align: center;
        }
        .wind-arrow { display: inline-block; color: var(--accent); }
    </style>
</head>
<body>

    <div class="container">
        <h1>LentoSÃ¤Ã¤ Pro</h1>
        <p class="subtitle">Klikkaa tuntia nÃ¤hdÃ¤ksesi mallikohtaiset erot</p>

        <div class="search-group">
            <input id="city" type="text" placeholder="Hae kaupunkia...">
            <button onclick="haeSaa()">Hae</button>
        </div>

        <div id="mainContent" style="display:none;">
            <div class="section" id="otsikko" style="font-weight:700; text-align:center;">Sijainti</div>
            <div class="section" id="statusArea"></div>
            <h3>12h Ennuste (Keskiarvo)</h3>
            <div id="tunnit" class="scroll-x"></div>
        </div>
    </div>

    <div id="detailOverlay">
        <div class="close-btn" onclick="closeDetails()">âœ•</div>
        <h2 id="detailTime" style="margin-top:20px">Klo 12:00</h2>
        <p id="detailDate" style="opacity: 0.5;"></p>

        <div class="section">
            <h4 style="margin:0">Maanpinnan tuuli (m/s)</h4>
            <div class="model-grid" id="windGrid"></div>
        </div>

        <div class="section">
            <h4 style="margin:0">LÃ¤mpÃ¶tila (Â°C)</h4>
            <div class="model-grid" id="tempGrid"></div>
        </div>

        <div class="section">
            <h4 style="margin:0">YlÃ¤tuulet (850hPa / 1500m)</h4>
            <div class="model-grid" id="upperWindGrid"></div>
        </div>
        
        <p style="font-size: 0.8rem; opacity: 0.4; text-align:center;">Vertailussa: ECMWF (Eurooppa), GFS (USA), ICON (Saksa)</p>
    </div>

    <script>
        let weatherData = null; // Globaali tallennus datalle

        async function haeSaa() {
            const k = document.getElementById("city").value;
            if (!k) return;
            const geo = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${k}&count=1&language=fi`).then(r => r.json());
            const p = geo.results?.[0];
            if (!p) return;

            document.getElementById("otsikko").innerText = `ðŸ“ ${p.name}`;
            document.getElementById("mainContent").style.display = "block";

            const models = "ecmwf_ifs04,gfs_seamless,icon_seamless";
            const fields = "temperature_2m,windspeed_10m,winddirection_10m,windspeed_850hPa,winddirection_850hPa";
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${p.latitude}&longitude=${p.longitude}&hourly=${fields}&models=${models}&timezone=auto`).then(r => r.json());
            
            weatherData = res.hourly;
            renderHours();
        }

        function renderHours() {
            const h = weatherData;
            const nyt = new Date().toISOString().slice(0, 13) + ":00";
            const start = h.time.indexOf(nyt) || 0;
            const div = document.getElementById("tunnit");
            div.innerHTML = "";

            for (let i = start; i < start + 12; i++) {
                const w = calcAvg(i, "windspeed_10m");
                const d = calcAvg(i, "winddirection_10m");
                div.innerHTML += `
                    <div class="hour-card" onclick="showDetails(${i})">
                        <div style="font-size:0.7rem; opacity:0.5">${h.time[i].slice(11,16)}</div>
                        <div style="font-weight:700; margin:5px 0">${calcAvg(i, "temperature_2m")}Â°</div>
                        <div style="color:var(--accent); font-size:0.9rem">${w}m/s</div>
                        <div class="wind-arrow" style="transform:rotate(${d}deg)">â†‘</div>
                    </div>`;
            }
        }

        function calcAvg(idx, key) {
            const m = ["_ecmwf_ifs04", "_gfs_seamless", "_icon_seamless"];
            let sum = 0, c = 0;
            m.forEach(mod => { if(weatherData[key+mod]) { sum += weatherData[key+mod][idx]; c++; } });
            return (sum / c).toFixed(1);
        }

        function showDetails(idx) {
            const h = weatherData;
            document.getElementById("detailOverlay").style.display = "block";
            document.getElementById("detailTime").innerText = "Klo " + h.time[idx].slice(11, 16);
            document.getElementById("detailDate").innerText = h.time[idx].slice(0, 10);

            const mods = ["ecmwf_ifs04", "gfs_seamless", "icon_seamless"];
            const names = ["ECMWF", "GFS", "ICON"];

            // TÃ¤ytetÃ¤Ã¤n gridit
            const fillGrid = (elId, key, unit, isWind = false) => {
                let html = "";
                mods.forEach((m, i) => {
                    const val = h[key + "_" + m][idx];
                    const dir = isWind ? h[key.replace("speed", "direction") + "_" + m][idx] : 0;
                    html += `<div class="model-box">
                        <div style="font-size:0.7rem; opacity:0.6">${names[i]}</div>
                        <div style="font-weight:700">${val}${unit}</div>
                        ${isWind ? `<div class="wind-arrow" style="transform:rotate(${dir}deg)">â†‘</div>` : ""}
                    </div>`;
                });
                document.getElementById(elId).innerHTML = html;
            };

            fillGrid("windGrid", "windspeed_10m", " m/s", true);
            fillGrid("tempGrid", "temperature_2m", "Â°");
            fillGrid("upperWindGrid", "windspeed_850hPa", " m/s", true);
        }

        function closeDetails() {
            document.getElementById("detailOverlay").style.display = "none";
        }
    </script>
</body>
</html>
