<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PPG Sää</title>

<style>
body{
    font-family:system-ui;
    background:#0b1220;
    color:white;
    margin:0;
    padding:15px;
}
h1{margin-top:0}

.hour{
    display:flex;
    justify-content:space-between;
    padding:8px;
    border-bottom:1px solid #223;
}

.good{color:#6CFF8F}
.medium{color:#FFD166}
.bad{color:#FF6B6B}

.card{
    background:#111a2e;
    padding:12px;
    border-radius:10px;
    margin-bottom:12px;
}
</style>
</head>
<body>

<h1>PPG Lentokeli</h1>

<div class="card">
    <div id="status">Haetaan sijaintia…</div>
</div>

<div id="hours"></div>

<script>
/* ==========================
   TURBULENSSI-INDEKSI
   ========================== */
function turbulenceIndex(wind, gust, tempDiff){
    let shear = gust - wind;
    let index = wind*0.6 + shear*1.4 + Math.abs(tempDiff)*0.8;
    return index;
}

function ppgStatus(index){
    if(index < 8) return ["Hyvä", "good"];
    if(index < 14) return ["Rajalla", "medium"];
    return ["Huono", "bad"];
}

/* ==========================
   HAE SÄÄ
   ========================== */
async function haeSaa(lat,lon){

    document.getElementById("status").textContent="Haetaan säätä…";

    const url=
    `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,windspeed_10m,windgusts_10m&forecast_days=1`;

    const r=await fetch(url);
    const data=await r.json();

    renderHours(data.hourly);
}

/* ==========================
   RENDER
   ========================== */
function renderHours(h){

    const container=document.getElementById("hours");
    container.innerHTML="";

    let firstIndex=null;

    for(let i=0;i<24;i++){

        let wind=h.windspeed_10m[i];
        let gust=h.windgusts_10m[i];
        let temp=h.temperature_2m[i];

        let tempDiff=i>0?temp-h.temperature_2m[i-1]:0;

        let index=turbulenceIndex(wind,gust,tempDiff);
        let [txt,cls]=ppgStatus(index);

        if(firstIndex===null) firstIndex=index;

        let row=document.createElement("div");
        row.className="hour";

        let time=h.time[i].split("T")[1];

        row.innerHTML=`
            <div>${time}</div>
            <div>${wind.toFixed(1)} m/s</div>
            <div class="${cls}">${txt}</div>
        `;

        container.appendChild(row);
    }

    let [txt,cls]=ppgStatus(firstIndex);
    document.getElementById("status").innerHTML=
        `Tämän hetken lentokeli: <b class="${cls}">${txt}</b>`;
}

/* ==========================
   GEOLOKAATIO
   ========================== */
function start(){

    if(!navigator.geolocation){
        document.getElementById("status").textContent="Sijainti ei tuettu";
        return;
    }

    navigator.geolocation.getCurrentPosition(
        pos=>haeSaa(pos.coords.latitude,pos.coords.longitude),
        ()=>document.getElementById("status").textContent="Sijaintia ei saatu"
    );
}

start();
</script>

</body>
</html>