<div class="section" id="spotSuggestions">
    <h3 style="margin:0 0 15px 0; font-size: 0.9rem; opacity: 0.7; text-transform: uppercase;">Parhaat ikkunat (Rinteet)</h3>
    <div id="spotList">Lasketaan parhaita hetkiä...</div>
</div>

<script>
// 1. MÄÄRITÄ TÄHÄN LEMPIPAIKKASI
const rinnepaikat = [
    { nimi: "Ylläs (P)", lat: 67.56, lon: 24.22, minDeg: 315, maxDeg: 45, minW: 4, maxW: 10 },
    { nimi: "Hanko (E)", lat: 59.82, lon: 22.95, minDeg: 135, maxDeg: 225, minW: 5, maxW: 11 },
    { nimi: "Pallas (L)", lat: 68.05, lon: 24.06, minDeg: 225, maxDeg: 315, minW: 4, maxW: 10 }
];

// Lisää tämä kutsu haeSaa-funktion loppuun:
// analysoiRinteet();

async function analysoiRinteet() {
    const listDiv = document.getElementById("spotList");
    listDiv.innerHTML = "";

    for (const spot of rinnepaikat) {
        try {
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${spot.lat}&longitude=${spot.lon}&hourly=windspeed_10m,winddirection_10m&models=ecmwf_ifs04&timezone=auto`).then(r => r.json());
            const h = res.hourly;
            
            let loytyi = false;
            // Etsitään seuraava 48h ikkuna
            for (let i = 0; i < 48; i++) {
                const w = h.windspeed_10m[i];
                const d = h.winddirection_10m[i];
                
                if (w >= spot.minW && w <= spot.maxW && onkoSuuntaOk(d, spot.minDeg, spot.maxDeg)) {
                    const aika = new Date(h.time[i]);
                    listDiv.innerHTML += `
                        <div style="margin-bottom:10px; padding:10px; background:rgba(255,255,255,0.05); border-radius:12px; border-left: 4px solid var(--success);">
                            <div style="font-weight:700">${spot.nimi}</div>
                            <div style="font-size:0.8rem; opacity:0.8">${aika.toLocaleDateString('fi-FI', {weekday:'short'})} klo ${h.time[i].slice(11,16)}</div>
                            <div style="font-size:0.85rem; color:var(--accent)">${w} m/s • Suunta: ${d}°</div>
                        </div>`;
                    loytyi = true;
                    break; // Näytetään vain ensimmäinen löytynyt aika per paikka
                }
            }
            if (!loytyi) {
                listDiv.innerHTML += `<div style="font-size:0.8rem; opacity:0.4; margin-bottom:10px;">${spot.nimi}: Ei hyvää keliä 48h sisään.</div>`;
            }
        } catch (e) { console.error("Virhe rinneanalyysissä"); }
    }
}

function onkoSuuntaOk(d, min, max) {
    if (min < max) return d >= min && d <= max;
    return d >= min || d <= max; // Tapaukset, joissa sektio ylittää 360/0 rajan (esim. 315 - 45)
}
</script>
